# 1 网络基础
## 1.1 TCP/IP
TCP/IP是互联网相关的各类协议族的总称。包括TCP, IP, DNS, UDP, ...
### 1.1.1 应用层
各类通用的应用服务。如FTP, DNS, HTTP等。
### 1.1.2 传输层
提供网络中两台计算机的数据传输。包括TCP, UDP。
### 1.1.3 网路层
处理网络上流动的数据包。决定了传输路径。
### 1.1.4 链路层
处理链接网络的硬件部分。包含操作系统、网卡、光纤等。
## 1.2 传输流程
应用层（创建http报文） -> 传输层（加上TCP首部） -> 网络层（加上IP首部） -> 链路层（以太网首部）。  
发送端在分层传输过程，一层层加上首部，接收端接收后，每经过一层就去掉一个首部。

## 1.3 IP、TCP、DNS
### 1.3.1 IP协议
IP协议确保把各种数据包发送给对方，IP地址指明了节点的地址，MAC地址指明了网卡的固定地址。  
IP间的通信依赖MAC地址，当数据包在网络中中转时，目标IP地址是不会改变的，MAC地址会改变。  
使用ARP协议根据通信方的IP地址就可以反查出对应的MAC地址。  

### 1.3.2 TCP协议
TCP协议提供可靠的字节流服务，字节流服务指将大块数据分割成报文段为单位的数据包进行传输。  
为了可靠传输，TCP采用了三次握手策略：
1. 发送端发送带有SYN标志的数据包至接收端
2. 接收端收到后，回复带有SYN、ACK的数据包
3. 发送端回复带有ACK的数据包

### 1.3.3 DNS协议
DNS协议提供域名到IP地址的解析服务。  
用户通常使用域名来访问服务器，DNS协议提供通过域名查找IP地址的服务。

## 1.4 各种协议与HTTP协议的关系，以访问一个网站为例
发送端：  
首先通过DNS协议获取域名对应的IP地址；HTTP协议生成对目标资源的HTTP请求；TCP协议将请求报文分割成报文段，方便传输；IP协议提供中转、路由服务，在网络中传送数据包。   

接收端：
TCP协议将获取的报文段按序号重组；HTTP协议对请求的内容处理，生成对应资源的响应报文；响应报文同样经过TCP，IP协议回传给用户。  

## 1.5 URI和URL
### 1.5.1 统一资源标识符
URI是Uniform Resource Identifier的缩写。  
URI用字符串表示某一互联网资源，URL表示资源的站点，URL是URI的子集。  
URI的例子：  
ftp://ftp.a.com/b.txt    
http://www.c.org/d.txt

# 2 简单的HTTP协议
## 2.1 HTTP协议用于客户端和服务端之间的通信
在使用HTTP协议时，必定一方担任客户端角色，另一端担任服务端角色。
## 2.2 通过请求和响应的交换达成通信
HTTP协议规定，请求从客户端发出，最后服务端响应请求并返回，即肯定从客户端开始建立通信。
## 2.3 HTTP是无状态协议
HTTP协议自身不对请求和响应之间的通信状态进行保存，即对发送过的请求或响应都不做持久化处理。
## 2.4 请求URI定位资源
HTTP协议使用URI定位互联网上的资源，会在请求报文中指定请求URI。

## 2.5 告知服务器意图的HTTP方法
- GET 获取资源
- POST 将数据发送给服务器
- PUT 传输文件
- DELETE 删除文件
- HEAD 与GET类似，但只获取报文首部，不要主体
- OPTIONS 询问服务器支持的方法

## 2.6 持久连接节省通信量
在HTTP的初始版本中，每进行一次HTTP通信就要断开一次TCP连接。比如使用浏览器访问一个包含多张图片的HTML页面时，必须要进行多次通信，不断地建立、断开TCP连接。  
### 2.6.1 持久连接
HTTP1.1提出了持久连接，只要没有任意一端明确提出断开连接，则保持TCP连接状态。  
### 2.6.2 管线化
持久连接使管线化发送成为可能，即将多个HTTP请求整批提交的技术，无需等待服务端的响应。

## 2.7 使用Cookie的状态管理
无状态协议不保存状态，减少了服务器的压力，但是在使用中也会带来麻烦，如切换页面就需要重新登录的问题。  
Cookie技术通过在报文中写入Cookie信息来控制客户端的状态。  
服务端发送的响应报文内的Set-Cookie字段会通知客户端保存Cookie，下次客户端发送请求时，会自动在请求报文中加入Cookie后再发出。  
服务端发现请求中的Cookie后，通过对比服务器上的记录，就能得到对应客户端的状态信息。

# 3 HTTP报文内的HTTP信息
## 3.1 HTTP报文
HTTP报文可分为报文首部和报文主体。  
## 3.2 请求报文和响应报文
请求报文的首部第一行是请求行，包含请求方法，URI和HTTP版本。如 GET / HTTP/1.1  
响应报文的首部第一行是状态行，包含状态码，原因短语和HTTP版本。 如 HTTP/1.1 200 OK  
接下来就是表死各种属性和条件的各类首部。  
## 3.3 获取部分内容的范围请求
对于10000字节的资源，可以只请求5001~10000字节内的资源。  
执行范围请求时，使用首部字段Range来指定资源的byte范围。
```
Range: bytes=5001-10000
```
针对范围请求，服务器会返回206 Partial Content的响应报文；若无法处理范围请求，则返回200 OK和完整的实体内容。  
## 3.4 内容协商返回最合适的内容
根据浏览器的语言设置，访问相同的URI，会显示对应语言版本的页面。这样的机制称为内容协商（Content Negotiation）

# 4 返回结果的HTTP状态码
状态码告知从服务端返回的请求结果。状态码如200 OK，由3位数字和原因短语组成。
## 4.1 2xx 成功
### 4.1.1 200 OK
表示请求在服务端正常处理了。
### 4.1.2 204 No Content
请求成功，但是没有资源可返回。
### 4.1.3 206 Partial Content
客户端进行了范围请求，只返回部分资源。
## 4.2 3xx 重定向
### 4.2.1 301 Moved Permanently
永久重定向，表示请求的资源已被分配新的URI，以后应使用新的URI访问。
### 4.2.2 302 Found
表示请求的资源临时分配到新的URI，希望客户端本次使用新的URI访问。
### 4.2.3 303 See Other
与302类似，但服务器明确要求客户端使用GET请求。
### 4.2.4 304 Not Modified
客户端发送附带条件的请求（即GET请求报文中有If-Match等首部），服务器找到的资源不符合条件。
### 4.2.5 307 Temporary Redirect
临时重定向，与302一样。
## 4.3 4xx 客户端错误
### 4.3.1 400 Bad Request
请求报文中存在语法错误。
### 4.3.2 401 Unauthorized
发送的请求需要有通过HTTP认证（BASIC认证、DIGEST认证）的认证信息。
### 4.3.3 403 Forbidden
请求被服务器拒绝了。
### 4.3.4 404 Not Found
服务器上没有请求的资源。
## 4.4 5xx 服务器错误
### 4.4.1 500 Internal Server Error
服务端在执行请求时发生了错误。
### 4.4.2 503 Service Unavailable
服务器超负荷或停机维护，无法处理请求。

# 5 与HTTP协作的Web服务器
